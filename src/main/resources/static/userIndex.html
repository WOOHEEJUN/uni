<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>Uni Messenger</title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/css/index.css">
  <style>
    .user-actions {
      display: flex;
      align-items: center;
      gap: 6px; /* 간격 줄임 */
    }
    .all-board-button {
      margin-bottom: 8px; /* 버튼 여백 최소화 */
    }
  </style>
</head>
<body>

  <!-- 헤더 -->
  <header>
  <div class="header-container">
    <a href="/userIndex.html" class="logo">
      <img src="/img/Uni_logo.png" alt="로고">
      Uni messenger
    </a>
    <div class="user-actions">
      <button class="chat-btn" onclick="goChat()">💬 익명 채팅방</button>
      <a href="/building-select.html"><button class="building-btn">🏢 건물 채팅방</button></a>
      <span id="userGreeting">123님 안녕하세요!</span>
      <span id="universityName">🏠 서울대학교</span>
      <a href="myPage.html"><button class="mypage-btn">마이페이지</button></a>
      <button class="logout-btn" onclick="logout()">로그아웃</button>
    </div>
  </div>
</header>

  <!-- 본문 -->
  <main>
    <!-- 🔥 HOT 게시물 (왼쪽) -->
    <div class="left">
      <div class="section">
        <h3>🔥 HOT 게시물</h3>
        <ul>
          <li><a href="#">💬 인기 글 1</a></li>
          <li><a href="#">💬 인기 글 2</a></li>
          <li><a href="#">💬 인기 글 3</a></li>
          <li><a href="#">💬 인기 글 4</a></li>
        </ul>
      </div>
    </div>

    <!-- 📢 공지사항 (가운데) -->
    <div class="center">
      <div class="section">
        <h3>📢 공지사항</h3>
        <p>💬 환영합니다! 여기는 Uni messenger입니다. 공지 및 메시지 공간입니다.</p>
      </div>
    </div>

    <div class="right">
      <div class="section">
        <h3>📁 게시판 목록</h3>
        <ul id="boardList">
          <!-- 게시판 목록이 동적으로 추가될 위치 -->
        </ul>
      </div>
    </div>
  </main>
  <!-- 푸터 -->
  <footer>
    ⓒ 2025 Uni Messenger. All rights reserved.
  </footer>

  <!-- 스크립트 -->
  <script>
    let currentUser = null;

    window.addEventListener("DOMContentLoaded", () => {
      fetch("/api/user/me", {
        method: "GET",
        headers: {
          "Authorization": "Bearer " + localStorage.getItem("token")
        }
      })
      .then(response => {
        if (!response.ok) throw new Error("인증 실패");
        return response.json();
      })
      .then(user => {
        currentUser = user;
        console.log("현재 로그인한 사용자 정보:", user);
        document.querySelector("#userGreeting").innerText = user.nickname + "님 안녕하세요!";
        if (user.universityName) {
          document.querySelector("#universityName").innerText = `🏫 ${user.universityName}`;
        }
        // 사용자 정보를 가져온 후 게시판 목록 로드
        loadUniversityBoards();
      })
      .catch(err => {
        console.error("사용자 정보 불러오기 실패:", err);
        document.querySelector("#userGreeting").innerText = "로그인이 필요합니다.";
        window.location.href = "loginjb.html";
      });
    });

    function loadUniversityBoards() {
      console.log("게시판 목록 로드 시작...");
      fetch("/api/boards/my-university", {
        method: "GET",
        headers: {
          "Authorization": "Bearer " + localStorage.getItem("token")
        }
      })
      .then(response => {
        if (!response.ok) throw new Error("게시판 목록을 가져오는데 실패했습니다.");
        return response.json();
      })
      .then(boards => {
        console.log("가져온 게시판 목록:", boards);
        const boardList = document.getElementById("boardList");
        boardList.innerHTML = ""; // 기존 목록 초기화
        
        boards.forEach(board => {
          console.log("게시판 정보:", board);
          const li = document.createElement("li");
          const a = document.createElement("a");
          a.href = `/boardHome.html?id=${board.id}`;
          a.textContent = board.name;
          li.appendChild(a);
          boardList.appendChild(li);
        });
      })
      .catch(err => {
        console.error("게시판 목록 로드 실패:", err);
        const boardList = document.getElementById("boardList");
        boardList.innerHTML = "<li>게시판을 불러오는데 실패했습니다.</li>";
      });
    }

    function logout() {
      localStorage.removeItem("token");
      alert("로그아웃 되었습니다.");
      window.location.href = "loginjb.html";
    }

    function goChat() {
      window.location.href = "chat.html";
    }
  </script>

</body>
</html>