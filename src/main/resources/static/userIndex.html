<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>Uni Messenger</title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/css/index.css">
  <style>
    .user-actions {
      display: flex;
      align-items: center;
      gap: 6px; /* ê°„ê²© ì¤„ì„ */
    }
    .all-board-button {
      margin-bottom: 8px; /* ë²„íŠ¼ ì—¬ë°± ìµœì†Œí™” */
    }
  </style>
</head>
<body>

  <!-- í—¤ë” -->
  <header>
  <div class="header-container">
    <a href="/userIndex.html" class="logo">
      <img src="/img/Uni_logo.png" alt="ë¡œê³ ">
      Uni messenger
    </a>
    <div class="user-actions">
      <button class="chat-btn" onclick="goChat()">ğŸ’¬ ìµëª… ì±„íŒ…ë°©</button>
      <a href="/building-select.html"><button class="building-btn">ğŸ¢ ê±´ë¬¼ ì±„íŒ…ë°©</button></a>
      <span id="userGreeting">123ë‹˜ ì•ˆë…•í•˜ì„¸ìš”!</span>
      <span id="universityName">ğŸ  ì„œìš¸ëŒ€í•™êµ</span>
      <a href="myPage.html"><button class="mypage-btn">ë§ˆì´í˜ì´ì§€</button></a>
      <button class="logout-btn" onclick="logout()">ë¡œê·¸ì•„ì›ƒ</button>
    </div>
  </div>
</header>

  <!-- ë³¸ë¬¸ -->
  <main>
    <!-- ğŸ”¥ HOT ê²Œì‹œë¬¼ (ì™¼ìª½) -->
    <div class="left">
      <div class="section">
        <h3>ğŸ”¥ HOT ê²Œì‹œë¬¼</h3>
        <ul>
          <li><a href="#">ğŸ’¬ ì¸ê¸° ê¸€ 1</a></li>
          <li><a href="#">ğŸ’¬ ì¸ê¸° ê¸€ 2</a></li>
          <li><a href="#">ğŸ’¬ ì¸ê¸° ê¸€ 3</a></li>
          <li><a href="#">ğŸ’¬ ì¸ê¸° ê¸€ 4</a></li>
        </ul>
      </div>
    </div>

    <!-- ğŸ“¢ ê³µì§€ì‚¬í•­ (ê°€ìš´ë°) -->
    <div class="center">
      <div class="section">
        <h3>ğŸ“¢ ê³µì§€ì‚¬í•­</h3>
        <p>ğŸ’¬ í™˜ì˜í•©ë‹ˆë‹¤! ì—¬ê¸°ëŠ” Uni messengerì…ë‹ˆë‹¤. ê³µì§€ ë° ë©”ì‹œì§€ ê³µê°„ì…ë‹ˆë‹¤.</p>
      </div>
    </div>

    <div class="right">
      <div class="section">
        <h3>ğŸ“ ê²Œì‹œíŒ ëª©ë¡</h3>
        <ul id="boardList">
          <!-- ê²Œì‹œíŒ ëª©ë¡ì´ ë™ì ìœ¼ë¡œ ì¶”ê°€ë  ìœ„ì¹˜ -->
        </ul>
      </div>
    </div>
  </main>
  <!-- í‘¸í„° -->
  <footer>
    â“’ 2025 Uni Messenger. All rights reserved.
  </footer>

  <!-- ìŠ¤í¬ë¦½íŠ¸ -->
  <script>
    let currentUser = null;

    window.addEventListener("DOMContentLoaded", () => {
      fetch("/api/user/me", {
        method: "GET",
        headers: {
          "Authorization": "Bearer " + localStorage.getItem("token")
        }
      })
      .then(response => {
        if (!response.ok) throw new Error("ì¸ì¦ ì‹¤íŒ¨");
        return response.json();
      })
      .then(user => {
        currentUser = user;
        console.log("í˜„ì¬ ë¡œê·¸ì¸í•œ ì‚¬ìš©ì ì •ë³´:", user);
        document.querySelector("#userGreeting").innerText = user.nickname + "ë‹˜ ì•ˆë…•í•˜ì„¸ìš”!";
        if (user.universityName) {
          document.querySelector("#universityName").innerText = `ğŸ« ${user.universityName}`;
        }
        // ì‚¬ìš©ì ì •ë³´ë¥¼ ê°€ì ¸ì˜¨ í›„ ê²Œì‹œíŒ ëª©ë¡ ë¡œë“œ
        loadUniversityBoards();
      })
      .catch(err => {
        console.error("ì‚¬ìš©ì ì •ë³´ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨:", err);
        document.querySelector("#userGreeting").innerText = "ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.";
        window.location.href = "loginjb.html";
      });
    });

    function loadUniversityBoards() {
      console.log("ê²Œì‹œíŒ ëª©ë¡ ë¡œë“œ ì‹œì‘...");
      fetch("/api/boards/my-university", {
        method: "GET",
        headers: {
          "Authorization": "Bearer " + localStorage.getItem("token")
        }
      })
      .then(response => {
        if (!response.ok) throw new Error("ê²Œì‹œíŒ ëª©ë¡ì„ ê°€ì ¸ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
        return response.json();
      })
      .then(boards => {
        console.log("ê°€ì ¸ì˜¨ ê²Œì‹œíŒ ëª©ë¡:", boards);
        const boardList = document.getElementById("boardList");
        boardList.innerHTML = ""; // ê¸°ì¡´ ëª©ë¡ ì´ˆê¸°í™”
        
        boards.forEach(board => {
          console.log("ê²Œì‹œíŒ ì •ë³´:", board);
          const li = document.createElement("li");
          const a = document.createElement("a");
          a.href = `/boardHome.html?id=${board.id}`;
          a.textContent = board.name;
          li.appendChild(a);
          boardList.appendChild(li);
        });
      })
      .catch(err => {
        console.error("ê²Œì‹œíŒ ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨:", err);
        const boardList = document.getElementById("boardList");
        boardList.innerHTML = "<li>ê²Œì‹œíŒì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.</li>";
      });
    }

    function logout() {
      localStorage.removeItem("token");
      alert("ë¡œê·¸ì•„ì›ƒ ë˜ì—ˆìŠµë‹ˆë‹¤.");
      window.location.href = "loginjb.html";
    }

    function goChat() {
      window.location.href = "chat.html";
    }
  </script>

</body>
</html>